# -*- coding: utf-8 -*-
import numpy as np
import math
import matplotlib.pyplot as plt

l=0.235
R=0.3
w=1
D=0.001
t=np.arange(0, 8.0*math.pi*R, 0.001)
dt=0.001
k1=1
k2=1
xd=R*np.sin(w*t)
yd=R*(1-np.cos(w*t))
#xdp=R*w*np.cos(w*t)
#ydp=R*w*np.sin(w*t)
#xdtpp=-R*w**2*np.sin(w*t)
#ydtpp=R*w**2*np.cos(w*t)
#xdtppp=-R*w**3*np.cos(w*t)
#ydtppp=-R*w**3*np.sin(w*t)
#vd1t=np.sqrt(xdtp**2+ydtp**2)
#vd1t=np.sqrt(np.abs(xdtp**2+ydtp**2))*np.sign(xdtp**2+ydtp**2)
#vd2t=L*vd1t*((ydtppp*xdtp)*vd1t**2-3*(ydtpp*xdtp-xdtpp*ydtp)*(xdtp*xdtpp+ydtp*ydtpp))/(vd1t**6+L**2*(ydtpp*xdtp-xdtpp*ydtp)**2)

xi=0
yi=0
thi=0
phii=math.atan(l/R)
X=[]
Y=[]
TH=[]
PHI=[]
T=[]
THP=[]
PHIP=[]
Z1=[]
Z2=[]
Z1P=[]
Z2P=[]
ZD1=[]
ZD2=[]
R1=[]
R2=[]
i=0
x=xi
y=yi
th=thi
phi=phii
while i<len(xd):
    X.append(x)
    Y.append(y)
    TH.append(th)
    PHI.append(phi)
    zd1=xd[i]+l*math.cos(th)+D*math.cos(th+phi)
    zd2=yd[i]+l*math.sin(th)+D*math.sin(th+phi)
    z1=x+l*math.cos(th)+D*math.cos(th+phi)
    z2=y+l*math.sin(th)+D*math.sin(th+phi)
    z1p=math.cos(th)-math.tan(phi)*(math.sin(th)+D*math.sin(th+phi)/l)-D*math.sin(th+phi)
    z2p=math.sin(th)+math.tan(phi)*(math.cos(th)+D*math.cos(th+phi)/l)*D*math.cos(th+phi)
    ZD1.append(zd1)
    ZD2.append(zd2)
    Z1.append(z1)
    Z2.append(z2)
    Z1P.append(z1p)
    Z2P.append(z2p)
    r1=z1p+k1*(zd1-z1)
    r2=z2p+k2*(zd2-z2)
    R1.append(r1)
    R2.append(r2)
    thp=math.sin(phi)*(math.cos(th+phi)*r1+math.sin(th+phi)*r2)/l
    phip=-(math.cos(th+phi)*math.sin(phi)/l+math.sin(th+phi)/D)*r1-(math.sin(th+phi)*math.sin(phi)/l-math.cos(th+phi)/D)*r2
    THP.append(thp)
    PHIP.append(phip)
    x=r1*dt-l*math.cos(th)-D*math.cos(th+phi)
    y=r2*dt-l*math.sin(th)-D*math.sin(th+phi)
    th=thp*dt
    phi=phip*dt
    i=i+1

#plt.plot(xd, yd)
plt.plot(X, Y)
plt.axis('equal')
plt.show()
